---
title: "Text-to-speech with R"
draft: false
author: Shirin Glander
date: '2018-06-27'
categories: ["R"]
tags: ["R"]
thumbnailImagePosition: left
thumbnailImage: https://shiring.github.io/netlify_images/speech-icon-2797263_1280.png
metaAlignment: center
coverMeta: out
slug: text_to_speech_r
---

Computers started talking to us! They do this with so called Text-to-Speech (TTS) systems. With neural nets, deep learning and lots of training data, these systems have gotten a whole lot better in recent years. In some cases, they are so good that you can't distinguish between human and machine voice.

In one of our recent [codecentric.AI](https://blog.codecentric.de/2018/04/kuenstliche-intelligenz-codecentric_ai/) [videos](https://youtu.be/2EEMSsVBE8w), we compared [different Text-to-Speech systems](https://youtu.be/2EEMSsVBE8w) (the video is in German, though - but the text snippets and their voice recordings we show in the video are a mix of German and English). In this video, we had a small contest between Polly, Alexa, Siri And Co to find out who best speaks different tongue twisters.

<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/2EEMSsVBE8w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

Here, I want to find out what's possible with R and Text-to-Speech packages.

<br>

PS: In a second post I also tried the [googleLanguageR](https://shirinsplayground.netlify.com/2018/06/googlelanguager) package - with much better results!

## How does TTS work?

Challenges for good TTS systems are the complexity of the human language: we intone words differently, depending on where they are in a sentence, what we want to convey with that sentence, how our mood is, and so on. AI-based TTS systems can take phonemes and intonation into account.

There are different ways to artificially produce speech.
A very important method is Unit Selection synthesis. With this method, text is first normalized and divided into smaller entities that represent sentences, syllables, words, phonemes, etc. The structure (e.g. the pronunciation) of these entities is then learned in context. We call this part Natural Language Processing (NLP). Usually, these learned segments are stored in a database (either as human voice recordings or synthetically generated) that can be searched to find suitable speech parts (Unit Selection). This search is often done with decision trees, neural nets or Hidden-Markov-Models.

If the speech has been generated by a computer, this is called formant synthesis. It offers more flexibility because the collection of words isn't limited to what has been pre-recorded by a human. Even imaginary or new words can easily be produced and the voices can be readily exchanged. Until recently, this synthetic voice did not sound anything like a human recorded voice; you could definitely hear that it was "fake". Most of the TTS systems today still suffer from this, but this is in the process of changing: there are already a few artificial TTS systems that do sound very human. 

## What TTS systems are there?

We already find TTS systems in many digital devices, like computers, smart phones, etc. Most of the "big players" offer TTS-as-a-service, but there are also many "smaller" and free programs for TTS. Many can be downloaded as software or used from a web browser or as an API. Here is an incomplete list:

- Microsoft/Windows: includes [**Narrator**](https://support.microsoft.com/de-de/help/22798/windows-10-narrator-get-started) and [**Microsoft Speech API**](https://www.microsoft.com/en-us/download/details.aspx?id=10121)
- Mac: [**VoiceOver**](https://www.apple.com/de/accessibility/mac/vision/)
- Linux: different software can be installed, e.g. [**eSpeak**](https://sourceforge.net/projects/espeak/files/espeak/)
- [IBM Watson](https://www.ibm.com/watson/services/text-to-speech/)
- [Google Cloud](https://cloud.google.com/text-to-speech/)
- [Microsoft Azure](https://azure.microsoft.com/de-de/services/cognitive-services/speech/)
- [Amazon Alexa](https://developer.amazon.com/de/alexa)
- [Siri on iPhone](https://9to5mac.com/2017/03/10/how-to-get-siri-to-read-articles-to-you-on-ios-macos/)
- [Polly on Amazon AWS](https://aws.amazon.com/de/polly/)
- [Microsoft Cortana](https://support.microsoft.com/de-de/help/17214/windows-10-what-is)
- [FreeTTS](https://freetts.sourceforge.io/docs/)
- [iSpeech](https://www.ispeech.org/text.to.speech)
- [Natural Readers](https://www.naturalreaders.com/online/)
- [Balabolka](http://www.cross-plus-a.com/balabolka.htm)
- [Panopreter](https://www.panopreter.com/en/products/pb/download.php)
- [text2speech.org](https://www.text2speech.org/)
- [text-to-speech-translator.paralink.com/](http://text-to-speech-translator.paralink.com/)

## Text-to-Speech in R

The only package for TTS I found was `Rtts`. It doesn't seem very comprehensive but it does the job of converting text to speech. The only API that works right now is **ITRI (http://tts.itri.org.tw)**. And it only supports English and Chinese.

Let's try it out!

```{r}
library(Rtts)
```

Here, I'll be using a quote from **DOUGLAS ADAMS’ THE HITCHHIKER’S GUIDE TO THE GALAXY**:

```{r eval=FALSE}
content <- "A common mistake that people make when trying to design something completely foolproof is to underestimate the ingenuity of complete fools."
```

The main TTS function is `tts_ITRI()` and I'm going to loop over the different voice options.

```{r eval=FALSE}
speakers = c("Bruce", "Theresa", "Angela", "MCHEN_Bruce", "MCHEN_Joddess", "ENG_Bob", "ENG_Alice", "ENG_Tracy")
lapply(speakers, function(x) tts_ITRI(content, speaker = x,
         destfile = paste0("audio_tts_", x, ".mp3")))
```

I uploaded the results to Soundcloud for you to hear:
- [audio-tts-bruce](https://soundcloud.com/shirin-glander-729692416/audio-tts-bruce/s-iZC6u?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)
- [audio-tts-theresa](https://soundcloud.com/shirin-glander-729692416/audio-tts-theresa/s-lYt0R?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)
- [audio-tts-angela](https://soundcloud.com/shirin-glander-729692416/audio-tts-angela/s-KVUMS?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)
- [audio-tts-mchen-bruce](https://soundcloud.com/shirin-glander-729692416/audio-tts-mchen-bruce/s-KVDeb?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)
- [audio-tts-mchen-joddess](https://soundcloud.com/shirin-glander-729692416/audio-tts-mchen-joddess/s-mDdik?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)
- [audio-tts-eng-bob](https://soundcloud.com/shirin-glander-729692416/audio-tts-eng-bob/s-520Y2?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)
- [audio-tts-eng-alice](https://soundcloud.com/shirin-glander-729692416/audio-tts-eng-alice/s-BKTpj?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)
- [audio-tts-eng-tracy](https://soundcloud.com/shirin-glander-729692416/audio-tts-eng-tracy/s-SKVDm?in=shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea)


As you can hear, it sounds quite wonky. There are many better alternatives out there, but most of them aren't free and/or can't be used (as easily) from R. Noam Ross tried [IBM Watson's TTS API in this post](https://rpubs.com/noamross/153216), which would be a very good solution. Or you could access the [Google Cloud](https://cloud.google.com/text-to-speech/) API from within R.

The most convenient solution for me was to use [**eSpeak**](https://sourceforge.net/projects/espeak/files/espeak/) from the command line. The output sounds relatively good, it is free and offers many languages and voices with lots of parameters to tweak. This is how you would produce audio from text with eSpeak:

- English US

```{}
espeak -v english-us -s 150 -w '/Users/shiringlander/Documents/Github/audio_tts_espeak_en_us.wav' "A common mistake that people make when trying to design something completely foolproof is to underestimate the ingenuity of complete fools."
```

- just for fun: English Scottish

```{}
espeak -v en-scottish -s 150 -w '/Users/shiringlander/Documents/Github/audio_tts_espeak_en-scottish.wav' "A common mistake that people make when trying to design something completely foolproof is to underestimate the ingenuity of complete fools."
```

- even funnier: German

```{}
espeak -v german -s 150 -w '/Users/shiringlander/Documents/Github/audio_tts_espeak_german.wav' "A common mistake that people make when trying to design something completely foolproof is to underestimate the ingenuity of complete fools."
```

The [playlist](https://soundcloud.com/shirin-glander-729692416/sets/text-to-speech-blogpost/s-lXYea) contains all audio files I generated in this post.

---

```{r}
sessionInfo()
```

