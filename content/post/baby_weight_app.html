---
title: "Baby Weight Shiny app"
draft: true
author: Shirin Elsinghorst
date: '2020-09-05'
categories: ["R"]
tags: ["R", "Shiny", "tidyverse", "ggplot", "plotly"]
thumbnailImagePosition: left
thumbnailImage: img/who_baby_weight_app.png
metaAlignment: center
coverMeta: out
slug: baby_weight_app
---



<p>Alright, this is it: I am officially back! :-D</p>
<p>I have not written any blogposts for over a year. Last year, I had the cutest baby boy and ever since then, I did not get around to doing much coding. One of the reasons was that, unfortunately, we did not have the easiest of starts with the little one. Feeding problems led to weight gain problems, so we had to weigh him regularly. Because I wanted to see for myself if we were on the right track with his weight gain, I created this <a href="https://shiring.shinyapps.io/who_baby_weight/">Baby Weight Shiny app</a>. With the app, I could easily visualize how we compared to the <a href="https://www.who.int/childgrowth/standards/weight_for_age/en/">WHO baby/childen weight-for-age tables</a>.</p>
<p>Here, I’ll describe how I built the plots. The entire code for building the app can be found on <a href="https://github.com/ShirinG/who_baby_weight_app">Github</a>.</p>
<p><br></p>
<div class="figure">
<img src="https://shirinsplayground.netlify.app/img/who_baby_weight_app.png" alt="" />
<p class="caption">Baby Weight Shiny app</p>
</div>
<div id="reference-data" class="section level2">
<h2>Reference data</h2>
<p>I am using the following <a href="https://www.who.int/childgrowth/standards/weight_for_age/en/">WHO baby/childen weight-for-age tables</a>:</p>
<ul>
<li>Percentiles girls &amp; boys</li>
</ul>
<p>I combined girls’ and boys’ data into one table each for:</p>
<ul>
<li>Weight-for-age: <a href="https://github.com/ShirinG/who_baby_weight_app/blob/master/p_0_13.csv">Birth to 13 weeks</a></li>
<li>Weight-for-age: <a href="https://github.com/ShirinG/who_baby_weight_app/blob/master/p_0_5.csv">Birth to 5 years</a></li>
</ul>
</div>
<div id="adding-my-own-measurements" class="section level2">
<h2>Adding my own measurements</h2>
<p>I collected all our weight measurements in a <code>.csv</code> file with two columns:</p>
<ul>
<li>a <code>date</code> column in the format <code>%d.%m.%Y</code> (<code>dd.mm.yyyy</code>)</li>
<li>a <code>weight</code> column in <em>g</em> or <em>kg</em></li>
</ul>
<p><strong>The first row has to contain the birthdate and birthweight</strong>, as this is, what was used to calculate the growth percentile to follow.</p>
<p>Because, obviously, I am not going to make my son’s actual weight data available on the internet, I created some mock data, similar to real-world examples (weight in <em>g</em>):</p>
<pre class="r"><code>library(readr)
library(lubridate)

weight_measures &lt;- read_delim(&quot;/Users/shiringlander/Documents/Github/who_baby_weight_app/data/weight_measures.csv&quot;,
                            delim = &quot;,&quot;,
                            col_types = list(col_date(format = &quot;%d.%m.%Y&quot;), col_double()))
head(weight_measures)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   date       weight
##   &lt;date&gt;      &lt;dbl&gt;
## 1 2019-08-12   3168
## 2 2019-08-16   3126
## 3 2019-08-17   3138
## 4 2019-08-18   3348
## 5 2019-08-20   3286
## 6 2019-08-22   3626</code></pre>
<p>In the <a href="https://shiring.shinyapps.io/who_baby_weight/">Baby Weight Shiny app</a>, you can upload this mock data or your own data. The choose:</p>
<ul>
<li>whether the columns in your <code>.csv</code> are separated by <strong>comma, semicolon or tabulator</strong></li>
<li>whether you want to show only reference values for the <strong>first 13 weeks</strong> or for the <strong>first 5 years</strong> (only reference values corresponding to your measurement dates will be shown)</li>
<li>whether your weight data is given in <strong>gramm or kilogramm</strong> and</li>
<li>whether you want to display reference data for <strong>girls or boys</strong></li>
</ul>
<pre class="r"><code>library(tidyverse)
source(&quot;/Users/shiringlander/Documents/Github/who_baby_weight_app/functions/combine_measures.R&quot;)
p_0_5 &lt;- read_csv(&quot;/Users/shiringlander/Documents/Github/who_baby_weight_app/data/p_0_5.csv&quot;)
p_0_13 &lt;- read_csv(&quot;/Users/shiringlander/Documents/Github/who_baby_weight_app/data/p_0_13.csv&quot;)
        
combine_measures_who_final &lt;- combine_measures_who(weight_measures, 
                                                   p_0_13, p_0_5,
                                                   age_range = &quot;0_5&quot;,
                                                   weight_in = &quot;g&quot;,
                                                   gender = &quot;boy&quot;)
head(combine_measures_who_final)</code></pre>
<pre><code>## # A tibble: 6 x 10
##   date       weight ref     percentile starting_p Month     L     M     S gender
##   &lt;date&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
## 1 2019-08-12   3.17 measur… measureme… P50           NA    NA    NA    NA &lt;NA&gt;  
## 2 2019-08-16   3.13 measur… measureme… P50           NA    NA    NA    NA &lt;NA&gt;  
## 3 2019-08-17   3.14 measur… measureme… P50           NA    NA    NA    NA &lt;NA&gt;  
## 4 2019-08-18   3.35 measur… measureme… P50           NA    NA    NA    NA &lt;NA&gt;  
## 5 2019-08-20   3.29 measur… measureme… P50           NA    NA    NA    NA &lt;NA&gt;  
## 6 2019-08-22   3.63 measur… measureme… P50           NA    NA    NA    NA &lt;NA&gt;</code></pre>
<pre class="r"><code># add missing dates for calculating weight change per week of life
reference_date &lt;- weight_measures$date[[1]]
end_date &lt;- weight_measures$date[[nrow(weight_measures)]]

starting_p &lt;- combine_measures_who_final %&gt;% 
  filter(date == reference_date) %&gt;%
  select(starting_p) %&gt;%
  .[[1]] %&gt;%
  .[1]
        
all_dates &lt;- seq(from = reference_date, to = end_date, by = &quot;day&quot;) %&gt;%
  as_tibble()
colnames(all_dates) = &quot;date&quot;
        
weight_measures_all &lt;- weight_measures %&gt;%
  full_join(all_dates, by = &quot;date&quot;) %&gt;%
  arrange(date)

## approximate missing values
weight_measures_all &lt;- weight_measures_all %&gt;%
  mutate(weight_approx = approx(weight, n = nrow(.))[[2]])
        
## add running week number
nos &lt;- rep(1:ceiling(nrow(weight_measures_all)/7), each = 7)
weight_measures_all$week &lt;- nos[1:nrow(weight_measures_all)]
        
## calculate sum over week
weight_measures_all &lt;- weight_measures_all %&gt;%
  mutate(diff_day = c(0, diff(weight_approx, lag = 1)),
         diff_week = c(rep(0, 7), diff(weight_approx, lag = 7)))
        
source(&quot;/Users/shiringlander/Documents/Github/who_baby_weight_app/functions/elapsed_months.R&quot;)
weight_measures_all &lt;- weight_measures_all %&gt;%
  mutate(month = elapsed_months(date, reference_date))</code></pre>
</div>
<div id="the-curve" class="section level2">
<h2>The curve</h2>
<p><img src="https://shirinsplayground.netlify.app/img/baby_weight_curve.png" /></p>
<pre class="r"><code>gender &lt;- &quot;boys&quot;
age &lt;- &quot;years 1 through 5&quot;
        
combine_measures_who_final %&gt;%
  ggplot(aes(date, weight,
             linetype = ref,
             color = percentile)) +
  geom_line() +
  geom_point() +
  labs(x = &quot;Date&quot;,
       y = &quot;Weight in kg&quot;,
       title = &quot;WHO child growth standard percentiles&quot;,
       subtitle = paste(&quot;Shown for&quot;, gender, age)) +
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/post/baby_weight_app_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>test_curves &lt;- combine_measures_who_final %&gt;%
  filter(percentile == !!paste(starting_p)) %&gt;%
  left_join(select(weight_measures_all, date, weight_approx), by = &quot;date&quot;)

paste(&quot;Your reference percentile is:&quot;, starting_p)</code></pre>
<pre><code>## [1] &quot;Your reference percentile is: P50&quot;</code></pre>
<pre class="r"><code>paste(&quot;Correlation between your measurements and your reference percentile is:&quot;,
      round(cor(test_curves$weight, test_curves$weight_approx, use = &#39;complete.obs&#39;), digits = 5))</code></pre>
<pre><code>## [1] &quot;Correlation between your measurements and your reference percentile is: 0.99322&quot;</code></pre>
</div>
<div id="barchart" class="section level2">
<h2>Barchart</h2>
<p>Bar colors show whether the weekly weight gain is above (blue) or below (red) the required minimum for BREASTFED babies given by <a href="https://www.stillkinder.de/gewicht-und-wachstum-von-gestillten-kindern/">this German site about breastfeeding</a>:</p>
<ul>
<li>in months 1 and 2, the minimum weight gain should be: 170 g</li>
<li>in months 3 and 4: 110 g</li>
<li>in months 5 and 6: 70 g and</li>
<li>from month 7 to 12: 40 g</li>
</ul>
<pre class="r"><code>weight_measures_all &lt;- weight_measures_all %&gt;%
  mutate(color = ifelse(month &lt;= 2 &amp; diff_week &gt;= 170, &quot;ok&quot;,
                        ifelse(month == 3 &amp; diff_week &gt;= 110, &quot;ok&quot;,
                               ifelse(month == 4 &amp; diff_week &gt;= 110, &quot;ok&quot;,
                                      ifelse(month == 5 &amp; diff_week &gt;= 70, &quot;ok&quot;,
                                             ifelse(month == 6 &amp; diff_week &gt;= 70, &quot;ok&quot;,
                                                    ifelse(month &gt;=7 &amp; diff_week &gt;= 40, &quot;ok&quot;, &quot;low&quot;)))))))</code></pre>
<pre class="r"><code>weight_measures_all %&gt;%
  distinct(week, .keep_all = TRUE) %&gt;%
  ggplot(aes(x = date, y = diff_week, fill = color)) +
  geom_bar(stat = &quot;identity&quot;) +
  scale_fill_brewer(palette = &quot;Set1&quot;) +
  labs(x = &quot;Date&quot;,
       y = &quot;Weight difference in gramm&quot;,
       title = &quot;Weekly weight differences&quot;,
       subtitle = &quot;Weight at each full week compared to one week prior&quot;) +
  theme_bw()</code></pre>
<p><img src="/post/baby_weight_app_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p><br></p>
<p><a href="https://www.stillkinder.de/gewicht-und-wachstum-von-gestillten-kindern/" class="uri">https://www.stillkinder.de/gewicht-und-wachstum-von-gestillten-kindern/</a></p>
<p>Am 10.-14. Lebenstag sollte es sein Geburtsgewicht wieder erreicht haben.</p>
<p>Nach 3 Wochen muss es sein Geburtsgewicht wieder erreicht haben.</p>
<p>In den ersten 2 Monaten nimmt es normalerweise 170 – 330 g pro Woche zu.</p>
<p>Im 3. – 4. Monat 110 – 330 g pro Woche, 5. – 6. Monat 70 – 140 g pro Woche und vom 7. – 12. Monat 40 – 110 g pro Woche.</p>
<hr />
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] forcats_0.5.0   stringr_1.4.0   dplyr_1.0.2     purrr_0.3.4    
##  [5] tidyr_1.1.2     tibble_3.0.3    ggplot2_3.3.2   tidyverse_1.3.0
##  [9] lubridate_1.7.9 readr_1.3.1    
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_1.1.0   xfun_0.16          haven_2.3.1        colorspace_1.4-1  
##  [5] vctrs_0.3.3        generics_0.0.2     htmltools_0.5.0    yaml_2.2.1        
##  [9] utf8_1.1.4         blob_1.2.1         rlang_0.4.7        pillar_1.4.6      
## [13] withr_2.2.0        glue_1.4.2         DBI_1.1.0          RColorBrewer_1.1-2
## [17] dbplyr_1.4.4       modelr_0.1.8       readxl_1.3.1       lifecycle_0.2.0   
## [21] munsell_0.5.0      blogdown_0.20      gtable_0.3.0       cellranger_1.1.0  
## [25] rvest_0.3.6        evaluate_0.14      labeling_0.3       knitr_1.29        
## [29] fansi_0.4.1        broom_0.7.0        Rcpp_1.0.5         backports_1.1.9   
## [33] scales_1.1.1       jsonlite_1.7.0     farver_2.0.3       fs_1.5.0          
## [37] hms_0.5.3          digest_0.6.25      stringi_1.4.6      bookdown_0.20     
## [41] grid_4.0.2         cli_2.0.2          tools_4.0.2        magrittr_1.5      
## [45] crayon_1.3.4       pkgconfig_2.0.3    ellipsis_0.3.1     xml2_1.3.2        
## [49] reprex_0.3.0       rstudioapi_0.11    assertthat_0.2.1   rmarkdown_2.3     
## [53] httr_1.4.2         R6_2.4.1           compiler_4.0.2</code></pre>
</div>
