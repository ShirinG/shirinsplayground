

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.27 with theme Tranquilpeak 0.4.1-BETA">
    <title>Code for case study - Customer Churn with Keras/TensorFlow and H2O</title>
    <meta name="author" content="Dr. Shirin Glander">
    <meta name="keywords" content=", R">

    <link rel="icon" href="img/favicon.png">
    

    
    <meta name="description" content="This is code that accompanies a book chapter on customer churn that I have written for dpunkt Verlag. The book is in German and will probably appear in December: https://www.dpunkt.de/buecher/13208/9783864906107-data-science.html.
Inspiration &amp; Sources Thank you to the following people for providing excellent code examples about customer churn:
 Matt Dancho: http://www.business-science.io/business/2017/11/28/customer_churn_analysis_keras.html JJ Allaire: https://github.com/rstudio/keras-customer-churn Susan Li: https://towardsdatascience.com/predict-customer-churn-with-r-9e62357d47b4 John Sullivan: https://jtsulliv.github.io/churn-eda/   Setup All analyses are done in R using RStudio.">
    <meta property="og:description" content="This is code that accompanies a book chapter on customer churn that I have written for dpunkt Verlag. The book is in German and will probably appear in December: https://www.dpunkt.de/buecher/13208/9783864906107-data-science.html.
Inspiration &amp; Sources Thank you to the following people for providing excellent code examples about customer churn:
 Matt Dancho: http://www.business-science.io/business/2017/11/28/customer_churn_analysis_keras.html JJ Allaire: https://github.com/rstudio/keras-customer-churn Susan Li: https://towardsdatascience.com/predict-customer-churn-with-r-9e62357d47b4 John Sullivan: https://jtsulliv.github.io/churn-eda/   Setup All analyses are done in R using RStudio.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Code for case study - Customer Churn with Keras/TensorFlow and H2O">
    <meta property="og:url" content="/2018/12/customer_churn_code/">
    <meta property="og:site_name" content="Shirin&#39;s playgRound">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Shirin&#39;s playgRound">
    <meta name="twitter:description" content="This is code that accompanies a book chapter on customer churn that I have written for dpunkt Verlag. The book is in German and will probably appear in December: https://www.dpunkt.de/buecher/13208/9783864906107-data-science.html.
Inspiration &amp; Sources Thank you to the following people for providing excellent code examples about customer churn:
 Matt Dancho: http://www.business-science.io/business/2017/11/28/customer_churn_analysis_keras.html JJ Allaire: https://github.com/rstudio/keras-customer-churn Susan Li: https://towardsdatascience.com/predict-customer-churn-with-r-9e62357d47b4 John Sullivan: https://jtsulliv.github.io/churn-eda/   Setup All analyses are done in R using RStudio.">
    
      <meta name="twitter:creator" content="@ShirinGlander">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7f7f818e55624edfef8aa93860a1a3d4?s=640">
    

    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="/css/style-hbs5om8csx9a8yrv5hnhpi2qqdv4ykuslajwbramhqxvleqbfklxgek50hye.min.css" />
    
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-86119417-1', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/">Shirin&#39;s playgRound</a>
  </div>
  
    
      <a class="header-right-picture "
         href="/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/7f7f818e55624edfef8aa93860a1a3d4?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <h1 class="sidebar-profile-title">Code for case study - Customer Churn with Keras/TensorFlow and H2O</h1>
        <a href="https://blog.feedspot.com/r_programming_blogs/" rel="nofollow" title="R Programming Blogs"><img alt="R Programming Blogs" src="https://blog.feedspot.com/wp-content/uploads/2018/04/r_program_216px.png?x20694"/></a>
        <a href="/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7f7f818e55624edfef8aa93860a1a3d4?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Dr. Shirin Glander</h4>
        
          <h5 class="sidebar-profile-bio">Biologist turned Bioinformatician turned Data Scientist</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/archives/">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/page/about/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/page/conferences_podcasts_webinars/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Hear me talk</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://shiring.github.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">My old R-blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.codecentric.de/kuenstliche-intelligenz/">
    
      <i class="sidebar-button-icon fa fa-lg fa-angle-double-right"></i>
      
      <span class="sidebar-button-desc">codecentric.ai</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/ShirinG">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/shirin-glander-01120881/">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/6623620/shirin-glander">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/ShirinGlander">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.xing.com/profile/Shirin_Glander">
    
      <i class="sidebar-button-icon fa fa-lg fa-xing"></i>
      
      <span class="sidebar-button-desc">Xing</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.meetup.com/Munster-R-Users-Group">
    
      <i class="sidebar-button-icon fa fa-lg fa-meetup"></i>
      
      <span class="sidebar-button-desc">MünsteR</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.r-bloggers.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">R-bloggers</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.r-users.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">R-users</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaOut
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title" itemprop="headline">
      Code for case study - Customer Churn with Keras/TensorFlow and H2O
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-12-12T00:00:00Z">
        
  December 12, 2018

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="/categories/r">R</a>
    
  


  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>This is code that accompanies a <a href="https://www.dpunkt.de/buecher/13208/9783864906107-data-science.html">book</a> chapter on customer churn that I have written for dpunkt Verlag. The book is in German and will probably appear in December: <a href="https://www.dpunkt.de/buecher/13208/9783864906107-data-science.html" class="uri">https://www.dpunkt.de/buecher/13208/9783864906107-data-science.html</a>.</p>
<div id="inspiration-sources" class="section level1">
<h1>Inspiration &amp; Sources</h1>
<p>Thank you to the following people for providing excellent code examples about customer churn:</p>
<ul>
<li>Matt Dancho: <a href="http://www.business-science.io/business/2017/11/28/customer_churn_analysis_keras.html" class="uri">http://www.business-science.io/business/2017/11/28/customer_churn_analysis_keras.html</a></li>
<li>JJ Allaire: <a href="https://github.com/rstudio/keras-customer-churn" class="uri">https://github.com/rstudio/keras-customer-churn</a></li>
<li>Susan Li: <a href="https://towardsdatascience.com/predict-customer-churn-with-r-9e62357d47b4" class="uri">https://towardsdatascience.com/predict-customer-churn-with-r-9e62357d47b4</a></li>
<li>John Sullivan: <a href="https://jtsulliv.github.io/churn-eda/" class="uri">https://jtsulliv.github.io/churn-eda/</a></li>
</ul>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>All analyses are done in R using RStudio. For detailed session information including R version, operating system and package versions, see the <code>sessionInfo()</code> output at the end of this document.</p>
<p>All figures are produced with ggplot2.</p>
<ul>
<li>libraries</li>
</ul>
<pre class="r"><code># Load libraries
library(tidyverse) # for tidy data analysis
library(readr)     # for fast reading of input files
library(caret)     # for convenient splitting
library(mice)      # mice package for Multivariate Imputation by Chained Equations (MICE)
library(keras)     # for neural nets
library(lime)      # for explaining neural nets
library(rsample)   # for splitting training and test data
library(recipes)   # for preprocessing
library(yardstick) # for evaluation
library(ggthemes)  # for additional plotting themes
library(corrplot)  # for correlation

theme_set(theme_minimal())</code></pre>
<pre class="r"><code># Install Keras if you have not installed it before
# follow instructions if you haven&#39;t installed TensorFlow
install_keras()</code></pre>
<p><br></p>
</div>
<div id="data-preparation" class="section level1 tabset tabset-fade tabset-pills">
<h1>Data preparation</h1>
<div id="the-dataset" class="section level2">
<h2>The dataset</h2>
<p>The Telco Customer Churn data set is the same one that Matt Dancho used in his post (see above). It was downloaded from <a href="https://www.ibm.com/communities/analytics/watson-analytics-blog/predictive-insights-in-the-telco-customer-churn-data-set/">IBM Watson</a></p>
<pre class="r"><code>churn_data_raw &lt;- read_csv(&quot;WA_Fn-UseC_-Telco-Customer-Churn.csv&quot;)</code></pre>
<pre class="r"><code>head(churn_data_raw)</code></pre>
<pre><code>## # A tibble: 6 x 21
##   customerID gender SeniorCitizen Partner Dependents tenure PhoneService
##   &lt;chr&gt;      &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;       
## 1 7590-VHVEG Female             0 Yes     No              1 No          
## 2 5575-GNVDE Male               0 No      No             34 Yes         
## 3 3668-QPYBK Male               0 No      No              2 Yes         
## 4 7795-CFOCW Male               0 No      No             45 No          
## 5 9237-HQITU Female             0 No      No              2 Yes         
## 6 9305-CDSKC Female             0 No      No              8 Yes         
## # ... with 14 more variables: MultipleLines &lt;chr&gt;, InternetService &lt;chr&gt;,
## #   OnlineSecurity &lt;chr&gt;, OnlineBackup &lt;chr&gt;, DeviceProtection &lt;chr&gt;,
## #   TechSupport &lt;chr&gt;, StreamingTV &lt;chr&gt;, StreamingMovies &lt;chr&gt;,
## #   Contract &lt;chr&gt;, PaperlessBilling &lt;chr&gt;, PaymentMethod &lt;chr&gt;,
## #   MonthlyCharges &lt;dbl&gt;, TotalCharges &lt;dbl&gt;, Churn &lt;chr&gt;</code></pre>
<pre class="r"><code>dim(churn_data_raw)</code></pre>
<pre><code>## [1] 7043   21</code></pre>
<div id="eda" class="section level3">
<h3>EDA</h3>
<ul>
<li>proportion of churn</li>
</ul>
<pre class="r"><code>churn_data_raw %&gt;%
  count(Churn)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   Churn     n
##   &lt;chr&gt; &lt;int&gt;
## 1 No     5174
## 2 Yes    1869</code></pre>
<ul>
<li>plot categorical features</li>
</ul>
<pre class="r"><code>churn_data_raw %&gt;%
  mutate(SeniorCitizen = as.character(SeniorCitizen)) %&gt;%
  select(-customerID) %&gt;%
  select_if(is.character) %&gt;%
  select(Churn, everything()) %&gt;%
  gather(x, y, gender:PaymentMethod) %&gt;%
  count(Churn, x, y) %&gt;%
  ggplot(aes(x = y, y = n, fill = Churn, color = Churn)) +
    facet_wrap(~ x, ncol = 4, scales = &quot;free&quot;) +
    geom_bar(stat = &quot;identity&quot;, alpha = 0.5) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          legend.position = &quot;top&quot;) +
    scale_color_tableau() +
    scale_fill_tableau()</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/eda_chr-1.png" width="1152" /></p>
<ul>
<li>plot numerical features</li>
</ul>
<pre class="r"><code>churn_data_raw %&gt;%
  select(-customerID) %&gt;%
  #select_if(is.numeric) %&gt;%
  select(Churn, MonthlyCharges, tenure, TotalCharges) %&gt;%
  gather(x, y, MonthlyCharges:TotalCharges) %&gt;%
  ggplot(aes(x = y, fill = Churn, color = Churn)) +
    facet_wrap(~ x, ncol = 3, scales = &quot;free&quot;) +
    geom_density(alpha = 0.5) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          legend.position = &quot;top&quot;) +
    scale_color_tableau() +
    scale_fill_tableau()</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/eda_num-1.png" width="1152" /></p>
<pre class="r"><code>churn_data &lt;- churn_data_raw %&gt;%
  select(-customerID)</code></pre>
</div>
<div id="dealing-with-missing-values" class="section level3">
<h3>Dealing with missing values</h3>
<pre class="r"><code>md.pattern(churn_data, plot = FALSE)</code></pre>
<pre><code>##      gender SeniorCitizen Partner Dependents tenure PhoneService
## 7032      1             1       1          1      1            1
## 11        1             1       1          1      1            1
##           0             0       0          0      0            0
##      MultipleLines InternetService OnlineSecurity OnlineBackup
## 7032             1               1              1            1
## 11               1               1              1            1
##                  0               0              0            0
##      DeviceProtection TechSupport StreamingTV StreamingMovies Contract
## 7032                1           1           1               1        1
## 11                  1           1           1               1        1
##                     0           0           0               0        0
##      PaperlessBilling PaymentMethod MonthlyCharges Churn TotalCharges   
## 7032                1             1              1     1            1  0
## 11                  1             1              1     1            0  1
##                     0             0              0     0           11 11</code></pre>
<pre class="r"><code>imp &lt;- mice(data = churn_data,  print = FALSE)
train_data_impute &lt;- complete(imp, &quot;long&quot;)</code></pre>
<pre class="r"><code>churn_data &lt;- churn_data %&gt;%
  drop_na()</code></pre>
</div>
</div>
<div id="training-and-test-split" class="section level2">
<h2>Training and test split</h2>
<pre class="r"><code>set.seed(42)
index &lt;- createDataPartition(churn_data$Churn, p = 0.75, list = FALSE)</code></pre>
<pre class="r"><code>train_data &lt;- churn_data[index, ]
test_data  &lt;- churn_data[-index, ]

index2 &lt;- createDataPartition(train_data$Churn, p = 0.8, list = FALSE)

train_data &lt;- train_data[index2, ]
valid_data &lt;- train_data[-index2, ]</code></pre>
<pre class="r"><code>nrow(train_data)</code></pre>
<pre><code>## [1] 4221</code></pre>
<pre class="r"><code>nrow(valid_data)</code></pre>
<pre><code>## [1] 848</code></pre>
<pre class="r"><code>nrow(test_data)</code></pre>
<pre><code>## [1] 1757</code></pre>
</div>
<div id="pre-processing" class="section level2">
<h2>Pre-Processing</h2>
<blockquote>
<p>A recipe is a description of what steps should be applied to a data set in order to get it ready for data analysis.</p>
</blockquote>
<pre class="r"><code>recipe_churn &lt;- recipe(Churn ~ ., train_data) %&gt;%
  step_dummy(all_nominal(), -all_outcomes()) %&gt;%
  step_center(all_predictors(), -all_outcomes()) %&gt;%
  step_scale(all_predictors(), -all_outcomes()) %&gt;%
  prep(data = train_data)</code></pre>
<pre class="r"><code>train_data &lt;- bake(recipe_churn, newdata = train_data) %&gt;%
  select(Churn, everything())

valid_data &lt;- bake(recipe_churn, newdata = valid_data) %&gt;%
  select(Churn, everything())

test_data &lt;- bake(recipe_churn, newdata = test_data) %&gt;%
  select(Churn, everything())</code></pre>
<pre class="r"><code>train_y_drop &lt;- to_categorical(as.integer(train_data$Churn) - 1, 2)
colnames(train_y_drop) &lt;- c(&quot;No&quot;, &quot;Yes&quot;)

valid_y_drop &lt;- to_categorical(as.integer(valid_data$Churn) - 1, 2)
colnames(valid_y_drop) &lt;- c(&quot;No&quot;, &quot;Yes&quot;)

test_y_drop &lt;- to_categorical(as.integer(test_data$Churn) - 1, 2)
colnames(test_y_drop) &lt;- c(&quot;No&quot;, &quot;Yes&quot;)</code></pre>
<pre class="r"><code># if training with binary crossentropy
train_y_drop &lt;- train_y_drop[, 2, drop = FALSE]
head(train_y_drop)</code></pre>
<pre><code>##      Yes
## [1,]   1
## [2,]   1
## [3,]   0
## [4,]   1
## [5,]   0
## [6,]   0</code></pre>
<pre class="r"><code>valid_y_drop &lt;- valid_y_drop[, 2, drop = FALSE]
test_y_drop &lt;- test_y_drop[, 2, drop = FALSE]</code></pre>
<pre class="r"><code>train_data_bk &lt;- select(train_data, -Churn)
head(train_data_bk)</code></pre>
<pre><code>## # A tibble: 6 x 30
##   SeniorCitizen tenure MonthlyCharges TotalCharges gender_Male Partner_Yes
##           &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1        -0.439 -1.23          -0.356       -0.956       0.973      -0.965
## 2        -0.439 -1.23           0.207       -0.937      -1.03       -0.965
## 3        -0.439 -0.904         -1.16        -0.870      -1.03       -0.965
## 4        -0.439 -0.167          1.35         0.356      -1.03        1.04 
## 5        -0.439  1.22          -0.279        0.554       0.973      -0.965
## 6        -0.439 -0.781         -0.487       -0.742       0.973       1.04 
## # ... with 24 more variables: Dependents_Yes &lt;dbl&gt;,
## #   PhoneService_Yes &lt;dbl&gt;, MultipleLines_No.phone.service &lt;dbl&gt;,
## #   MultipleLines_Yes &lt;dbl&gt;, InternetService_Fiber.optic &lt;dbl&gt;,
## #   InternetService_No &lt;dbl&gt;, OnlineSecurity_No.internet.service &lt;dbl&gt;,
## #   OnlineSecurity_Yes &lt;dbl&gt;, OnlineBackup_No.internet.service &lt;dbl&gt;,
## #   OnlineBackup_Yes &lt;dbl&gt;, DeviceProtection_No.internet.service &lt;dbl&gt;,
## #   DeviceProtection_Yes &lt;dbl&gt;, TechSupport_No.internet.service &lt;dbl&gt;,
## #   TechSupport_Yes &lt;dbl&gt;, StreamingTV_No.internet.service &lt;dbl&gt;,
## #   StreamingTV_Yes &lt;dbl&gt;, StreamingMovies_No.internet.service &lt;dbl&gt;,
## #   StreamingMovies_Yes &lt;dbl&gt;, Contract_One.year &lt;dbl&gt;,
## #   Contract_Two.year &lt;dbl&gt;, PaperlessBilling_Yes &lt;dbl&gt;,
## #   PaymentMethod_Credit.card..automatic. &lt;dbl&gt;,
## #   PaymentMethod_Electronic.check &lt;dbl&gt;, PaymentMethod_Mailed.check &lt;dbl&gt;</code></pre>
<pre class="r"><code>valid_data_bk &lt;- select(valid_data, -Churn)
test_data_bk &lt;- select(test_data, -Churn)</code></pre>
<pre class="r"><code>train_data$Churn &lt;- ifelse(train_data$Churn == &quot;Yes&quot;, 1, 0)
valid_data$Churn &lt;- ifelse(valid_data$Churn == &quot;Yes&quot;, 1, 0)
test_data$Churn &lt;- ifelse(test_data$Churn == &quot;Yes&quot;, 1, 0)</code></pre>
<pre class="r"><code># alternative - not run
train_data_impute_bk &lt;- bake(recipe_churn, newdata = train_data_impute) %&gt;%
  select(Churn, everything())
train_data_impute_bk &lt;- cbind(train_data_impute$.imp, train_data_impute_bk)</code></pre>
</div>
<div id="modeling-with-keras" class="section level2">
<h2>Modeling with keras</h2>
<pre class="r"><code>model_keras &lt;- keras_model_sequential()

model_keras %&gt;% 
  layer_dense(units = 32, kernel_initializer = &quot;uniform&quot;, activation = &quot;relu&quot;, 
              input_shape = ncol(train_data_bk)) %&gt;% 
  layer_dropout(rate = 0.2) %&gt;%
  
  layer_dense(units = 16, kernel_initializer = &quot;uniform&quot;, activation = &quot;relu&quot;) %&gt;% 
  layer_dropout(rate = 0.2) %&gt;%
  
  layer_dense(units = 8, kernel_initializer = &quot;uniform&quot;, activation = &quot;relu&quot;) %&gt;% 
  layer_dropout(rate = 0.2) %&gt;%

  layer_dense(units = 1,
              kernel_initializer = &quot;uniform&quot;, activation = &quot;sigmoid&quot;) %&gt;%
  
  compile(
        optimizer = &#39;adamax&#39;,
        loss      = &#39;binary_crossentropy&#39;,
        metrics   = c(&quot;binary_accuracy&quot;, &quot;mse&quot;)
    )

summary(model_keras)</code></pre>
<pre><code>## ___________________________________________________________________________
## Layer (type)                     Output Shape                  Param #     
## ===========================================================================
## dense_1 (Dense)                  (None, 32)                    992         
## ___________________________________________________________________________
## dropout_1 (Dropout)              (None, 32)                    0           
## ___________________________________________________________________________
## dense_2 (Dense)                  (None, 16)                    528         
## ___________________________________________________________________________
## dropout_2 (Dropout)              (None, 16)                    0           
## ___________________________________________________________________________
## dense_3 (Dense)                  (None, 8)                     136         
## ___________________________________________________________________________
## dropout_3 (Dropout)              (None, 8)                     0           
## ___________________________________________________________________________
## dense_4 (Dense)                  (None, 1)                     9           
## ===========================================================================
## Total params: 1,665
## Trainable params: 1,665
## Non-trainable params: 0
## ___________________________________________________________________________</code></pre>
<pre class="r"><code>fit_keras &lt;- fit(model_keras, 
    x = as.matrix(train_data_bk), 
    y = train_y_drop,
    batch_size = 32, 
    epochs = 20,
    #validation_split = 0.30,
    validation_data = list(as.matrix(valid_data_bk), valid_y_drop),
    verbose = 2
    )</code></pre>
<pre class="r"><code>plot(fit_keras) +
  scale_color_tableau() +
  scale_fill_tableau()</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/plot_fit_keras-1.png" width="960" /></p>
</div>
<div id="evaluation" class="section level2">
<h2>Evaluation</h2>
<pre class="r"><code>pred_classes_test &lt;- predict_classes(object = model_keras, x = as.matrix(test_data_bk))
pred_proba_test  &lt;- predict_proba(object = model_keras, x = as.matrix(test_data_bk))</code></pre>
<pre class="r"><code>test_results &lt;- tibble(
  actual_yes = as.factor(as.vector(test_y_drop)),
  pred_classes_test = as.factor(as.vector(pred_classes_test)),
  Yes = as.vector(pred_proba_test), 
  No = 1 - as.vector(pred_proba_test))
head(test_results)</code></pre>
<pre><code>## # A tibble: 6 x 4
##   actual_yes pred_classes_test    Yes    No
##   &lt;fct&gt;      &lt;fct&gt;              &lt;dbl&gt; &lt;dbl&gt;
## 1 0          1                 0.510  0.490
## 2 0          0                 0.0342 0.966
## 3 1          1                 0.726  0.274
## 4 0          0                 0.471  0.529
## 5 1          0                 0.192  0.808
## 6 1          0                 0.371  0.629</code></pre>
<pre class="r"><code>test_results %&gt;% 
  conf_mat(actual_yes, pred_classes_test)</code></pre>
<pre><code>##           Truth
## Prediction    0    1
##          0 1165  223
##          1  125  244</code></pre>
<pre class="r"><code>test_results %&gt;% 
  metrics(actual_yes, pred_classes_test)</code></pre>
<pre><code>## # A tibble: 1 x 1
##   accuracy
##      &lt;dbl&gt;
## 1    0.802</code></pre>
<pre class="r"><code>test_results %&gt;% 
  roc_auc(actual_yes, Yes)</code></pre>
<pre><code>## [1] 0.8402146</code></pre>
<pre class="r"><code>tibble(
    precision = test_results %&gt;% yardstick::precision(actual_yes, pred_classes_test),
    recall    = test_results %&gt;% yardstick::recall(actual_yes, pred_classes_test)
)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   precision recall
##       &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.839  0.903</code></pre>
<pre class="r"><code># F1-Statistic
test_results %&gt;% yardstick::f_meas(actual_yes, pred_classes_test, beta = 1)</code></pre>
<pre><code>## [1] 0.8700523</code></pre>
</div>
<div id="h2o" class="section level2">
<h2>H2O</h2>
<pre class="r"><code>library(h2o)
h2o.init(nthreads = -1)</code></pre>
<pre><code>## 
## H2O is not running yet, starting it now...
## 
## Note:  In case of errors look at the following log files:
##     /var/folders/5j/v30zfr7s14qfhqwqdmqmpxw80000gn/T//RtmpU7M4Vg/h2o_shiringlander_started_from_r.out
##     /var/folders/5j/v30zfr7s14qfhqwqdmqmpxw80000gn/T//RtmpU7M4Vg/h2o_shiringlander_started_from_r.err
## 
## 
## Starting H2O JVM and connecting: .. Connection successful!
## 
## R is connected to the H2O cluster: 
##     H2O cluster uptime:         5 seconds 29 milliseconds 
##     H2O cluster timezone:       Europe/Berlin 
##     H2O data parsing timezone:  UTC 
##     H2O cluster version:        3.20.0.2 
##     H2O cluster version age:    3 months and 8 days  
##     H2O cluster name:           H2O_started_from_R_shiringlander_zvk734 
##     H2O cluster total nodes:    1 
##     H2O cluster total memory:   3.56 GB 
##     H2O cluster total cores:    8 
##     H2O cluster allowed cores:  8 
##     H2O cluster healthy:        TRUE 
##     H2O Connection ip:          localhost 
##     H2O Connection port:        54321 
##     H2O Connection proxy:       NA 
##     H2O Internal Security:      FALSE 
##     H2O API Extensions:         XGBoost, Algos, AutoML, Core V3, Core V4 
##     R Version:                  R version 3.5.1 (2018-07-02)</code></pre>
<pre class="r"><code>h2o.no_progress()

train_data_hf &lt;- as.h2o(train_data)
test &lt;- as.h2o(test_data)</code></pre>
<pre class="r"><code>splits &lt;- h2o.splitFrame(train_data_hf, 
                         ratios = c(0.8), 
                         seed = 1)

train &lt;- splits[[1]]
valid &lt;- splits[[2]]

response &lt;- &quot;Churn&quot;
features &lt;- setdiff(colnames(train), response)

# For binary classification, response should be a factor
train[, response] &lt;- as.factor(train[, response])
valid[, response] &lt;- as.factor(valid[, response])
test[, response] &lt;- as.factor(test[, response])</code></pre>
<pre class="r"><code>summary(train$Churn, exact_quantiles = TRUE)</code></pre>
<pre><code>##  Churn  
##  0:2491 
##  1: 900</code></pre>
<pre class="r"><code>summary(valid$Churn, exact_quantiles = TRUE)</code></pre>
<pre><code>##  Churn 
##  0:608 
##  1:222</code></pre>
<pre class="r"><code>summary(test$Churn, exact_quantiles = TRUE)</code></pre>
<pre><code>##  Churn  
##  0:1290 
##  1: 467</code></pre>
<blockquote>
<p>“During model training, you might find that the majority of your data belongs in a single class. For example, consider a binary classification model that has 100 rows, with 80 rows labeled as class 1 and the remaining 20 rows labeled as class 2. This is a common scenario, given that machine learning attempts to predict class 1 with the highest accuracy. It can also be an example of an imbalanced dataset, in this case, with a ratio of 4:1. The balance_classes option can be used to balance the class distribution. When enabled, H2O will either undersample the majority classes or oversample the minority classes. Note that the resulting model will also correct the final probabilities (“undo the sampling”) using a monotonic transform, so the predicted probabilities of the first model will differ from a second model. However, because AUC only cares about ordering, it won’t be affected. If this option is enabled, then you can also specify a value for the class_sampling_factors and max_after_balance_size options.” <a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/algo-params/balance_classes.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/algo-params/balance_classes.html</a></p>
</blockquote>
<p>The model was trained with <a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html">AutoML</a>. The best model was a Best Of Family Stacked Ensemble.</p>
<pre class="r"><code>aml &lt;- h2o.automl(x = features, 
                  y = response,
                  training_frame = train,
                  validation_frame = valid,
                  balance_classes = TRUE,
                  max_runtime_secs = 30)

# View the AutoML Leaderboard
lb &lt;- aml@leaderboard
lb</code></pre>
<pre><code>##                                                model_id       auc
## 1    StackedEnsemble_AllModels_0_AutoML_20180924_080417 0.8390006
## 2 StackedEnsemble_BestOfFamily_0_AutoML_20180924_080417 0.8380971
## 3             GBM_grid_0_AutoML_20180924_080417_model_5 0.8375690
## 4             GBM_grid_0_AutoML_20180924_080417_model_4 0.8365179
## 5             GLM_grid_0_AutoML_20180924_080417_model_0 0.8341097
## 6             GBM_grid_0_AutoML_20180924_080417_model_0 0.8302018
##     logloss mean_per_class_error      rmse       mse
## 1 0.4302326            0.2350645 0.3731759 0.1392603
## 2 0.4306768            0.2337383 0.3735453 0.1395361
## 3 0.4304155            0.2353403 0.3746078 0.1403310
## 4 0.4273302            0.2367815 0.3732200 0.1392931
## 5 0.4293852            0.2402290 0.3740019 0.1398774
## 6 0.4381734            0.2437888 0.3781282 0.1429809
## 
## [12 rows x 6 columns]</code></pre>
<pre class="r"><code>best_model &lt;- aml@leader
best_model</code></pre>
<pre><code>## Model Details:
## ==============
## 
## H2OBinomialModel: stackedensemble
## Model ID:  StackedEnsemble_AllModels_0_AutoML_20180924_080417 
## NULL
## 
## 
## H2OBinomialMetrics: stackedensemble
## ** Reported on training data. **
## 
## MSE:  0.128844
## RMSE:  0.3589485
## LogLoss:  0.4029882
## Mean Per-Class Error:  0.2135015
## AUC:  0.864463
## Gini:  0.7289259
## 
## Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
##           0    1    Error       Rate
## 0      1920  571 0.229225  =571/2491
## 1       178  722 0.197778   =178/900
## Totals 2098 1293 0.220879  =749/3391
## 
## Maximum Metrics: Maximum metrics at their respective thresholds
##                         metric threshold    value idx
## 1                       max f1  0.240878 0.658459 260
## 2                       max f2  0.146718 0.768209 311
## 3                 max f0point5  0.466968 0.654878 164
## 4                 max accuracy  0.466968 0.815394 164
## 5                max precision  0.855263 1.000000   0
## 6                   max recall  0.056069 1.000000 395
## 7              max specificity  0.855263 1.000000   0
## 8             max absolute_mcc  0.240878 0.520905 260
## 9   max min_per_class_accuracy  0.252481 0.781111 254
## 10 max mean_per_class_accuracy  0.200769 0.789078 282
## 
## Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
## H2OBinomialMetrics: stackedensemble
## ** Reported on validation data. **
## 
## MSE:  0.1282443
## RMSE:  0.3581121
## LogLoss:  0.405336
## Mean Per-Class Error:  0.2215505
## AUC:  0.859538
## Gini:  0.719076
## 
## Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
##          0   1    Error      Rate
## 0      544  64 0.105263   =64/608
## 1       75 147 0.337838   =75/222
## Totals 619 211 0.167470  =139/830
## 
## Maximum Metrics: Maximum metrics at their respective thresholds
##                         metric threshold    value idx
## 1                       max f1  0.415311 0.678984 154
## 2                       max f2  0.172145 0.755538 266
## 3                 max f0point5  0.415311 0.689493 154
## 4                 max accuracy  0.415311 0.832530 154
## 5                max precision  0.844644 1.000000   0
## 6                   max recall  0.054401 1.000000 398
## 7              max specificity  0.844644 1.000000   0
## 8             max absolute_mcc  0.415311 0.566133 154
## 9   max min_per_class_accuracy  0.241128 0.774775 226
## 10 max mean_per_class_accuracy  0.223147 0.785947 239
## 
## Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
## H2OBinomialMetrics: stackedensemble
## ** Reported on cross-validation data. **
## ** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **
## 
## MSE:  0.1392603
## RMSE:  0.3731759
## LogLoss:  0.4302326
## Mean Per-Class Error:  0.2350645
## AUC:  0.8390006
## Gini:  0.6780012
## 
## Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
##           0    1    Error       Rate
## 0      1879  612 0.245684  =612/2491
## 1       202  698 0.224444   =202/900
## Totals 2081 1310 0.240047  =814/3391
## 
## Maximum Metrics: Maximum metrics at their respective thresholds
##                         metric threshold    value idx
## 1                       max f1  0.233719 0.631674 254
## 2                       max f2  0.140878 0.751033 311
## 3                 max f0point5  0.440773 0.621547 169
## 4                 max accuracy  0.440773 0.799174 169
## 5                max precision  0.871047 1.000000   0
## 6                   max recall  0.049679 1.000000 399
## 7              max specificity  0.871047 1.000000   0
## 8             max absolute_mcc  0.225112 0.480566 260
## 9   max min_per_class_accuracy  0.240674 0.760000 251
## 10 max mean_per_class_accuracy  0.197308 0.767100 277
## 
## Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</code></pre>
<pre class="r"><code>pred &lt;- h2o.predict(best_model, test[, -1])</code></pre>
<pre class="r"><code>h2o.mean_per_class_error(best_model, train = TRUE, valid = TRUE, xval = TRUE)</code></pre>
<pre><code>##     train     valid      xval 
## 0.2135015 0.2215505 0.2350645</code></pre>
<pre class="r"><code>h2o.confusionMatrix(best_model, valid = TRUE)</code></pre>
<pre><code>## Confusion Matrix (vertical: actual; across: predicted)  for max f1 @ threshold = 0.415310953965713:
##          0   1    Error      Rate
## 0      544  64 0.105263   =64/608
## 1       75 147 0.337838   =75/222
## Totals 619 211 0.167470  =139/830</code></pre>
<pre class="r"><code>h2o.auc(best_model, train = TRUE)</code></pre>
<pre><code>## [1] 0.864463</code></pre>
<pre class="r"><code>h2o.auc(best_model, valid = TRUE)</code></pre>
<pre><code>## [1] 0.859538</code></pre>
<pre class="r"><code>h2o.auc(best_model, xval = TRUE)</code></pre>
<pre><code>## [1] 0.8390006</code></pre>
<pre class="r"><code>perf &lt;- h2o.performance(best_model, test)
h2o.confusionMatrix(perf)</code></pre>
<pre><code>## Confusion Matrix (vertical: actual; across: predicted)  for max f1 @ threshold = 0.276997331622412:
##           0   1    Error       Rate
## 0      1032 258 0.200000  =258/1290
## 1       132 335 0.282655   =132/467
## Totals 1164 593 0.221969  =390/1757</code></pre>
<pre class="r"><code>plot(perf)</code></pre>
<pre class="r"><code>h2o.logloss(perf)</code></pre>
<pre><code>## [1] 0.4232643</code></pre>
<pre class="r"><code>h2o.mse(perf)</code></pre>
<pre><code>## [1] 0.1364695</code></pre>
<pre class="r"><code>h2o.auc(perf)</code></pre>
<pre><code>## [1] 0.8463373</code></pre>
<pre class="r"><code>metrics &lt;- as.data.frame(h2o.metric(perf))
head(metrics)</code></pre>
<pre><code>##   threshold          f1          f2   f0point5  accuracy precision
## 1 0.8430345 0.004273504 0.002675227 0.01061571 0.7347752 1.0000000
## 2 0.8383468 0.012738854 0.008012821 0.03105590 0.7353443 0.7500000
## 3 0.8327149 0.025316456 0.016000000 0.06060606 0.7370518 0.8571429
## 4 0.8295517 0.033613445 0.021310602 0.07952286 0.7381901 0.8888889
## 5 0.8264970 0.050000000 0.031897927 0.11560694 0.7404667 0.9230769
## 6 0.8245281 0.062111801 0.039808917 0.14124294 0.7421742 0.9375000
##        recall specificity absolute_mcc min_per_class_accuracy
## 1 0.002141328   1.0000000   0.03966196            0.002141328
## 2 0.006423983   0.9992248   0.05235856            0.006423983
## 3 0.012847966   0.9992248   0.08466273            0.012847966
## 4 0.017130621   0.9992248   0.10120995            0.017130621
## 5 0.025695931   0.9992248   0.12846040            0.025695931
## 6 0.032119914   0.9992248   0.14576670            0.032119914
##   mean_per_class_accuracy  tns fns fps tps       tnr       fnr
## 1               0.5010707 1290 466   0   1 1.0000000 0.9978587
## 2               0.5028244 1289 464   1   3 0.9992248 0.9935760
## 3               0.5060364 1289 461   1   6 0.9992248 0.9871520
## 4               0.5081777 1289 459   1   8 0.9992248 0.9828694
## 5               0.5124604 1289 455   1  12 0.9992248 0.9743041
## 6               0.5156724 1289 452   1  15 0.9992248 0.9678801
##            fpr         tpr idx
## 1 0.0000000000 0.002141328   0
## 2 0.0007751938 0.006423983   1
## 3 0.0007751938 0.012847966   2
## 4 0.0007751938 0.017130621   3
## 5 0.0007751938 0.025695931   4
## 6 0.0007751938 0.032119914   5</code></pre>
<pre class="r"><code>metrics %&gt;%
  gather(x, y, f1:tpr) %&gt;%
  ggplot(aes(x = threshold, y = y, group = x)) +
    facet_wrap(~ x, ncol = 2, scales = &quot;free&quot;) +
    geom_line()</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/metrics-1.png" width="768" /></p>
<pre class="r"><code>threshold &lt;- metrics[order(-metrics$accuracy), &quot;threshold&quot;][1]

finalRf_predictions &lt;- data.frame(actual = as.vector(test$Churn), 
                                  as.data.frame(h2o.predict(object = best_model, 
                                                            newdata = test)))

finalRf_predictions$accurate &lt;- ifelse(finalRf_predictions$actual == 
                                         finalRf_predictions$predict, &quot;ja&quot;, &quot;nein&quot;)

finalRf_predictions$predict_stringent &lt;- ifelse(finalRf_predictions$p1 &gt; threshold, 1, 
                                                ifelse(finalRf_predictions$p0 &gt; threshold, 0, &quot;unsicher&quot;))
finalRf_predictions$accurate_stringent &lt;- ifelse(finalRf_predictions$actual == 
                                                   finalRf_predictions$predict_stringent, &quot;ja&quot;, 
                                       ifelse(finalRf_predictions$predict_stringent == 
                                                &quot;unsicher&quot;, &quot;unsicher&quot;, &quot;nein&quot;))

finalRf_predictions %&gt;%
  group_by(actual, predict) %&gt;%
  dplyr::summarise(n = n())</code></pre>
<pre><code>## # A tibble: 4 x 3
## # Groups:   actual [?]
##   actual predict     n
##   &lt;fct&gt;  &lt;fct&gt;   &lt;int&gt;
## 1 0      0        1125
## 2 0      1         165
## 3 1      0         189
## 4 1      1         278</code></pre>
<pre class="r"><code>finalRf_predictions %&gt;%
  group_by(actual, predict_stringent) %&gt;%
  dplyr::summarise(n = n())</code></pre>
<pre><code>## # A tibble: 4 x 3
## # Groups:   actual [?]
##   actual predict_stringent     n
##   &lt;fct&gt;  &lt;chr&gt;             &lt;int&gt;
## 1 0      0                  1161
## 2 0      1                   129
## 3 1      0                   210
## 4 1      1                   257</code></pre>
<pre class="r"><code>finalRf_predictions %&gt;%
  gather(x, y, accurate, accurate_stringent) %&gt;%
  mutate(x = ifelse(x == &quot;accurate&quot;, &quot;Default Schwelle: 0.5&quot;, 
                    paste(&quot;Angepasste Schwelle:&quot;, round(threshold, digits = 2)))) %&gt;%
  ggplot(aes(x = actual, fill = y)) +
    facet_grid(~ x) +
    geom_bar(position = &quot;dodge&quot;) +
    scale_fill_tableau()</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/default_vs_stringent-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>df &lt;- finalRf_predictions[, c(1, 3, 4)]

thresholds &lt;- seq(from = 0, to = 1, by = 0.1)

prop_table &lt;- data.frame(threshold = thresholds, 
                         prop_p0_true = NA, prop_p0_false = NA,
                         prop_p1_true = NA, prop_p1_false = NA)

for (threshold in thresholds) {

  pred_1 &lt;- ifelse(df$p1 &gt; threshold, 1, 0)
  pred_1_t &lt;- ifelse(pred_1 == df$actual, TRUE, FALSE)
  
  group &lt;- data.frame(df, 
                      &quot;pred_true&quot; = pred_1_t) %&gt;%
    group_by(actual, pred_true) %&gt;%
    dplyr::summarise(n = n())
  
  group_p0 &lt;- filter(group, actual == &quot;0&quot;)
  
  prop_p0_t &lt;- sum(filter(group_p0, pred_true == TRUE)$n) / sum(group_p0$n)
  prop_p0_f &lt;- sum(filter(group_p0, pred_true == FALSE)$n) / sum(group_p0$n)
  prop_table[prop_table$threshold == threshold, &quot;prop_p0_true&quot;] &lt;- prop_p0_t
  prop_table[prop_table$threshold == threshold, &quot;prop_p0_false&quot;] &lt;- prop_p0_f
  
  group_p1 &lt;- filter(group, actual == &quot;1&quot;)
  
  prop_p1_t &lt;- sum(filter(group_p1, pred_true == TRUE)$n) / sum(group_p1$n)
  prop_p1_f &lt;- sum(filter(group_p1, pred_true == FALSE)$n) / sum(group_p1$n)
  prop_table[prop_table$threshold == threshold, &quot;prop_p1_true&quot;] &lt;- prop_p1_t
  prop_table[prop_table$threshold == threshold, &quot;prop_p1_false&quot;] &lt;- prop_p1_f
}</code></pre>
<pre class="r"><code>prop_table %&gt;%
  gather(x, y, prop_p0_true, prop_p1_true) %&gt;%
  rename(Schwellenwert = threshold) %&gt;%
  mutate(x = ifelse(x == &quot;prop_p0_true&quot;, &quot;prop true p0&quot;,
         &quot;prop true p1&quot;)) %&gt;%
  ggplot(aes(x = Schwellenwert, y = y, color = x)) +
    geom_point() +
    geom_line() +
    scale_color_tableau()</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/prop_table-1.png" width="576" style="display: block; margin: auto;" /></p>
<div id="cost-calculation" class="section level3">
<h3>Cost calculation</h3>
<p>Let’s assume that</p>
<ol style="list-style-type: decimal">
<li>a marketing campaign + employee time will cost the company 1000€ per year for every customer that is included in the campaign.</li>
<li>the annual average revenue per customer is 2000€ (in more complex scenarios customers could be further divided into revenue groups to calculate how “valuable” they are and how harmful loosing them would be)</li>
<li>investing into unnecessary marketing doesn’t cause churn by itself (i.e. a customer who isn’t going to churn isn’t reacting negatively to the add campaign - which could happen in more complex scenarios).</li>
<li>without a customer churn model the company would target half of their customer (by chance) for ad-campaigns</li>
<li>without a customer churn model the company would lose about 25% of their customers to churn</li>
</ol>
<p>This would mean that compared to no intervention we would have</p>
<ul>
<li>prop_p0_true == customers who were correctly predicted to not churn did not cost anything (no marketing money was spent): +/-0€</li>
<li>prop_p0_false == customers that did not churn who are predicted to churn will be an empty investment: +/-0€ - 1500€</li>
<li>prop_p1_false == customer that were predicted to stay but churned: -2000€</li>
<li>prop_p1_true == customers that were correctly predicted to churn:</li>
<li>let’s say 100% of those could be kept by investing into marketing: +2000€ -1500€</li>
<li>let’s say 50% could be kept by investing into marketing: +2000€ * 0.5 -1500€</li>
</ul>
<pre class="r"><code># baseline

revenue &lt;- 2000
cost &lt;- 1000

customers_churn &lt;- filter(test_data, Churn == 1)
customers_churn_n &lt;- nrow(customers_churn)

customers_no_churn &lt;- filter(filter(test_data, Churn == 0))
customers_no_churn_n &lt;- nrow(customers_no_churn)

customers &lt;- customers_churn_n + customers_no_churn_n

ad_target_rate &lt;- 0.5
ad_cost_default &lt;- customers * ad_target_rate * cost

churn_rate_default &lt;- customers_churn_n / customers_no_churn_n
ann_revenue_default &lt;- customers_no_churn_n * revenue

net_win_default &lt;- ann_revenue_default - ad_cost_default
net_win_default</code></pre>
<pre><code>## [1] 1701500</code></pre>
<p>How much can we revenue gain from predicting customer churn:</p>
<pre class="r"><code>conversion &lt;- 0.7

net_win_table &lt;- prop_table %&gt;%
  mutate(prop_p0_true_X = prop_p0_true * customers_no_churn_n * revenue,
         prop_p0_false_X = prop_p0_false * customers_no_churn_n * (revenue -cost),
         prop_p1_false_X = prop_p1_false * customers_churn_n * 0,
         prop_p1_true_X = prop_p1_true * customers_churn_n * ((revenue * conversion) - cost)) %&gt;%
  group_by(threshold) %&gt;%
  summarise(net_win = sum(prop_p0_true_X + prop_p0_false_X + prop_p1_false_X + prop_p1_true_X),
            net_win_compared = net_win - net_win_default) %&gt;%
  arrange(-net_win_compared)

net_win_table</code></pre>
<pre><code>## # A tibble: 11 x 3
##    threshold net_win net_win_compared
##        &lt;dbl&gt;   &lt;dbl&gt;            &lt;dbl&gt;
##  1       0.8 2592200           890700
##  2       0.7 2591000           889500
##  3       0.6 2583400           881900
##  4       0.9 2580000           878500
##  5       1   2580000           878500
##  6       0.5 2554400           852900
##  7       0.4 2520000           818500
##  8       0.3 2470600           769100
##  9       0.2 2344200           642700
## 10       0.1 2139400           437900
## 11       0   1476800          -224700</code></pre>
</div>
</div>
<div id="lime" class="section level2">
<h2>LIME</h2>
<pre class="r"><code>Xtrain &lt;- as.data.frame(train)
Xtest &lt;- as.data.frame(test)

# run lime() on training set
explainer &lt;- lime::lime(x = Xtrain, 
                        model = best_model)

# run explain() on the explainer
explanation &lt;- lime::explain(x = Xtest[1:9, ], 
                             explainer = explainer, 
                             n_labels = 1,
                             n_features = 4,
                             kernel_width = 0.5)</code></pre>
<pre class="r"><code>plot_explanations(explanation)</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<pre class="r"><code>explanation %&gt;%
  plot_features(ncol = 3)</code></pre>
<p><img src="/post/2018-12-12_customer_churn_code_files/figure-html/unnamed-chunk-49-1.png" width="1248" /></p>
<hr />
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] de_DE.UTF-8/de_DE.UTF-8/de_DE.UTF-8/C/de_DE.UTF-8/de_DE.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] h2o_3.20.0.2    bindrcpp_0.2.2  corrplot_0.84   ggthemes_4.0.1 
##  [5] yardstick_0.0.1 recipes_0.1.3   rsample_0.0.2   broom_0.5.0    
##  [9] lime_0.4.0      keras_2.2.0     mice_3.3.0      caret_6.0-80   
## [13] lattice_0.20-35 forcats_0.3.0   stringr_1.3.1   dplyr_0.7.6    
## [17] purrr_0.2.5     readr_1.1.1     tidyr_0.8.1     tibble_1.4.2   
## [21] ggplot2_3.0.0   tidyverse_1.2.1
## 
## loaded via a namespace (and not attached):
##   [1] minqa_1.2.4        colorspace_1.3-2   class_7.3-14      
##   [4] rprojroot_1.3-2    pls_2.7-0          base64enc_0.1-3   
##   [7] rstudioapi_0.7     DRR_0.0.3          fansi_0.3.0       
##  [10] prodlim_2018.04.18 lubridate_1.7.4    xml2_1.2.0        
##  [13] codetools_0.2-15   splines_3.5.1      robustbase_0.93-2 
##  [16] knitr_1.20         shinythemes_1.1.1  RcppRoll_0.3.0    
##  [19] zeallot_0.1.0      jsonlite_1.5       nloptr_1.0.4      
##  [22] pROC_1.12.1        ddalpha_1.3.4      kernlab_0.9-27    
##  [25] tfruns_1.4         sfsmisc_1.1-2      shiny_1.1.0       
##  [28] compiler_3.5.1     httr_1.3.1         backports_1.1.2   
##  [31] assertthat_0.2.0   Matrix_1.2-14      lazyeval_0.2.1    
##  [34] cli_1.0.0          later_0.7.5        htmltools_0.3.6   
##  [37] tools_3.5.1        gtable_0.2.0       glue_1.3.0        
##  [40] reshape2_1.4.3     Rcpp_0.12.18       cellranger_1.1.0  
##  [43] nlme_3.1-137       blogdown_0.8       iterators_1.0.10  
##  [46] timeDate_3043.102  gower_0.1.2        xfun_0.3          
##  [49] lme4_1.1-18-1      rvest_0.3.2        mime_0.5          
##  [52] stringdist_0.9.5.1 pan_1.6            DEoptimR_1.0-8    
##  [55] MLmetrics_1.1.1    MASS_7.3-50        scales_1.0.0      
##  [58] ipred_0.9-7        promises_1.0.1     hms_0.4.2         
##  [61] parallel_3.5.1     yaml_2.2.0         reticulate_1.10   
##  [64] rpart_4.1-13       stringi_1.2.4      tensorflow_1.9    
##  [67] foreach_1.4.4      lava_1.6.3         geometry_0.3-6    
##  [70] bitops_1.0-6       rlang_0.2.2        pkgconfig_2.0.2   
##  [73] evaluate_0.11      bindr_0.1.1        labeling_0.3      
##  [76] htmlwidgets_1.2    CVST_0.2-2         tidyselect_0.2.4  
##  [79] plyr_1.8.4         magrittr_1.5       bookdown_0.7      
##  [82] R6_2.2.2           magick_1.9         mitml_0.3-6       
##  [85] dimRed_0.1.0       pillar_1.3.0       haven_1.1.2       
##  [88] whisker_0.3-2      withr_2.1.2        RCurl_1.95-4.11   
##  [91] survival_2.42-6    abind_1.4-5        nnet_7.3-12       
##  [94] modelr_0.1.2       crayon_1.3.4       jomo_2.6-4        
##  [97] utf8_1.1.4         rmarkdown_1.10     grid_3.5.1        
## [100] readxl_1.1.0       data.table_1.11.4  ModelMetrics_1.2.0
## [103] digest_0.6.17      xtable_1.8-3       httpuv_1.4.5      
## [106] stats4_3.5.1       munsell_0.5.0      glmnet_2.0-16     
## [109] magic_1.5-9</code></pre>
</div>
</div>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="//tags/api/">API</a>

  <a class="tag tag--primary tag--small" href="//tags/machine-learning/">machine learning</a>

  <a class="tag tag--primary tag--small" href="//tags/plumber/">plumber</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                <i class="fa fa-angle-left"></i>
                <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
              </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2018/11/neural_nets_explained/" data-tooltip="&#39;How do neural nets learn?&#39; A step by step explanation using the H2O Deep Learning algorithm.">
              
                <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2018/12/customer_churn_code/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2018/12/customer_churn_code/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2018/12/customer_churn_code/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Dr. Shirin Glander. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                <i class="fa fa-angle-left"></i>
                <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
              </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2018/11/neural_nets_explained/" data-tooltip="&#39;How do neural nets learn?&#39; A step by step explanation using the H2O Deep Learning algorithm.">
              
                <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2018/12/customer_churn_code/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2018/12/customer_churn_code/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2018/12/customer_churn_code/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=%2F2018%2F12%2Fcustomer_churn_code%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%2F2018%2F12%2Fcustomer_churn_code%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=%2F2018%2F12%2Fcustomer_churn_code%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7f7f818e55624edfef8aa93860a1a3d4?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Dr. Shirin Glander</h4>
    
      <div id="about-card-bio">Biologist turned Bioinformatician turned Data Scientist</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Data Scientist
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Münster, Germany
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/12/customer_churn_code/">
                <h3 class="media-heading">Code for case study - Customer Churn with Keras/TensorFlow and H2O</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">This is code that accompanies a book chapter on customer churn that I have written for dpunkt Verlag. The book is in German and will probably appear in December: https://www.dpunkt.de/buecher/13208/9783864906107-data-science.html.
Inspiration &amp; Sources Thank you to the following people for providing excellent code examples about customer churn:
 Matt Dancho: http://www.business-science.io/business/2017/11/28/customer_churn_analysis_keras.html JJ Allaire: https://github.com/rstudio/keras-customer-churn Susan Li: https://towardsdatascience.com/predict-customer-churn-with-r-9e62357d47b4 John Sullivan: https://jtsulliv.github.io/churn-eda/   Setup All analyses are done in R using RStudio.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/11/neural_nets_explained/">
                <h3 class="media-heading">&#39;How do neural nets learn?&#39; A step by step explanation using the H2O Deep Learning algorithm.</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">In my last blogpost about Random Forests I introduced the codecentric.ai Bootcamp. The next part I published was about Neural Networks and Deep Learning. Every video of our bootcamp will have example code and tasks to promote hands-on learning. While the practical parts of the bootcamp will be using Python, below you will find the English R version of this Neural Nets Practical Example, where I explain how neural nets learn and how the concepts and techniques translate to training neural nets in R with the H2O Deep Learning function.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/10/ml_basics_rf/">
                <h3 class="media-heading">Machine Learning Basics - Random Forest</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">A few colleagues of mine and I from codecentric.ai are currently working on developing a free online course about machine learning and deep learning. As part of this course, I am developing a series of videos about machine learning basics - the first video in this series was about Random Forests.
You can find the video on YouTube but as of now, it is only available in German. Same goes for the slides, which are also currently German only.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/10/rladieslondon_slides/">
                <h3 class="media-heading">Slides from my talk at the R-Ladies Meetup about Interpretable Deep Learning with R, Keras and LIME</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">During my stay in London for the m3 conference, I also gave a talk at the R-Ladies London Meetup on Tuesday, October 16th, about one of my favorite topics: Interpretable Deep Learning with R, Keras and LIME.
 Keras is a high-level open-source deep learning framework that by default works on top of TensorFlow. Keras is minimalistic, efficient and highly flexible because it works with a modular layer system to define, compile and fit neural networks.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/10/mcubed_slides/">
                <h3 class="media-heading">Slides from my m-cubed talk about Explaining complex machine learning models with LIME</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">The last two days, I was in London for the M-cubed conference.
Here are the slides from my talk about Explaining complex machine learning models with LIME:
 Traditional machine learning workflows focus heavily on model training and optimization; the best model is usually chosen via performance measures like accuracy or error and we tend to assume that a model is good enough for deployment if it passes certain thresholds of these performance criteria.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/10/twimlai189/">
                <h3 class="media-heading">Sketchnotes from TWiML&amp;AI: Evaluating Model Explainability Methods with Sara Hooker</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">These are my sketchnotes for Sam Charrington’s podcast This Week in Machine Learning and AI about Evaluating Model Explainability Methods with Sara Hooker:
Sketchnotes from TWiMLAI talk: Evaluating Model Explainability Methods with Sara Hooker
 You can listen to the podcast here.
  In this, the first episode of the Deep Learning Indaba series, we’re joined by Sara Hooker, AI Resident at Google Brain. I had the pleasure of speaking with Sara in the run-up to the Indaba about her work on interpretability in deep neural networks.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/10/meetup_nov18/">
                <h3 class="media-heading">Using R to help plan the future of transport. Join MünsteR for our next meetup!</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">In our next MünsteR R-user group meetup on Tuesday, November 20th, 2018, titled Using R to help plan the future of transport, Mark Padgham will provide an overview of several inter-related R packages for analysing urban dynamics.
You can RSVP here: http://meetu.ps/e/F7zDN/w54bW/f
 The primary motivation for developing these packages has been their use in Active Transport Futures - a group of researchers and coders striving to aid cities to better plan for futures in which active travel, particularly walking and cycling, plays an increasingly prominent role (lots of open source code at github.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/10/keras_fruits_cluster/">
                <h3 class="media-heading">Image clustering with Keras and k-Means</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">A while ago, I wrote two blogposts about image classification with Keras and about how to use your own models or pretrained models for predictions and using LIME to explain to predictions.
Recently, I came across this blogpost on using Keras to extract learned features from models and use those to cluster images. It is written in Python, though - so I adapted the code to R. You find the results below.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/09/ffm_datascience_meetup_slides/">
                <h3 class="media-heading">Slides from talk: &#39;Decoding The Black Box&#39; at the Frankfurt Data Science Meetup</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">On Wednesday, September 26th, I gave a talk about ‘Decoding The Black Box’ at the Frankfurt Data Science Meetup.
My slides were created with beautiful.ai and can be found here.
   DECODING THE BLACK BOX
  And finally we will have with us Dr.Shirin Glander, whom we were inviting for a long time back. Shirin lives in Münster and works as a Data Scientist at codecentric, she has lots of practical experience.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/09/ffm_datascience_meetup/">
                <h3 class="media-heading">I&#39;ll be talking about &#39;Decoding The Black Box&#39; at the Frankfurt Data Science Meetup</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">I have yet another Meetup talk to announce:
On Wednesday, September 26th, I’ll be talking about ‘Decoding The Black Box’ at the Frankfurt Data Science Meetup.
Particularly cool with this meetup is that they will livestream the event at www.youtube.com/c/FrankfurtDataScience!
 TALK#2: DECODING THE BLACK BOX
  And finally we will have with us Dr.Shirin Glander, whom we were inviting for a long time back. Shirin lives in Münster and works as a Data Scientist at codecentric, she has lots of practical experience.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         66 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('/images/autumn-2789234_1920.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" integrity="sha256-IFHWFEbU2/+wNycDECKgjIRSirRNIDp2acEB5fvdVRU=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js" integrity="sha256-+mpyNVJsNt4rVXCw0F+pAOiB3YxmHgrbJsx4ecPuUaI=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js" integrity="sha256-vMxgR/7FtLovVA+IPrR7+xTgIgARH7y9VZQnmmi0HDI=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js" integrity="sha256-N0qFUh7/9vLvia87dDndewmsgsyYoNkdA212tPc+2NI=" crossorigin="anonymous"></script>


<script src="/js/script-kr8dyqj6rb6ortyib7whfo9x9p6td6zo8t1v4fdz4ecx5kwybsdlmk1slygn.min.js"></script>


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = '\/2018\/12\/customer_churn_code\/';
          
            this.page.identifier = '\/2018\/12\/customer_churn_code\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'shirinsplayground';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

